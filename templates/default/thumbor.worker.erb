description "Thumbor image manipulation service"

start on runlevel [345]
stop on stopped thumbor

console log

<% if node['thumbor']['upstart_respawn'] -%>
respawn
respawn limit 5 10
<% end -%>
umask 022

setuid <%= node['thumbor']['user']%>
setgid <%= node['thumbor']['group']%>

env DAEMON=<%= node['thumbor']['binary']%>

env conffile=<%= node['thumbor']['conf_file']%>

env keyfile=<%= node['thumbor']['key_file']%>

env ip=<%= node['thumbor']['listen_address']%>

#chdir /var/lib/thumbor
chdir /usr/local/lib/python2.7/dist-packages/thumbor

instance $p

exec $DAEMON -c "${conffile}" -i "${ip}" -k "${keyfile}" -p "${p}"
